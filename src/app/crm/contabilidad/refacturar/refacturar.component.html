<ng-template #title let-name="name">
    <h5>{{ name }}</h5>
</ng-template>

<div class="card">
    <button class="btn btn-sm btn-danger" (click)="getAutorizaciones()">
        GET
    </button>
    <div class="card-body">
        <form
            class="md-float-material form-material m-t-10"
            [hidden]="!permiso"
        >
            <div class="md-tabs">
                <ngb-tabset (tabChange)="onChangeTab($event.nextId)" #tabs>
                    <ngb-tab id="tab-pendientes">
                        <ng-template ngbTabTitle>
                            <ng-container
                                [ngTemplateOutlet]="title"
                                [ngTemplateOutletContext]="{
                                    name: 'Pendientes'
                                }"
                            ></ng-container>
                        </ng-template>
                        <ng-template ngbTabContent>
                            <ng-container
                                [ngTemplateOutlet]="tablaPendientes"
                            ></ng-container>
                        </ng-template>
                    </ngb-tab>

                    <ngb-tab id="tab-terminados">
                        <ng-template ngbTabTitle>
                            <ng-container
                                [ngTemplateOutlet]="title"
                                [ngTemplateOutletContext]="{
                                    name: 'Terminados'
                                }"
                            ></ng-container>
                        </ng-template>
                        <ng-template ngbTabContent>
                            <ng-container
                                [ngTemplateOutlet]="tablaTerminados"
                            ></ng-container>
                        </ng-template>
                    </ngb-tab>
                </ngb-tabset>
            </div>
        </form>
        <h2 [hidden]="permiso">
            No cuenta con los permisos para ver este modulo!
        </h2>
    </div>
</div>

<ng-template #tablaPendientes>
    <div [@fadeInOutTranslate] class="m-t-50">
        <div class="row m-t-50">
            <div class="col-md-12 table-responsive">
                <table class="table table-striped" id="rf_pendientes">
                    <thead>
                        <tr>
                            <th>Documento</th>
                            <th>Venta</th>
                            <th>Solicitante</th>
                            <th>Creado</th>
                            <th>Paso</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of pendientes">
                            <td>
                                <button
                                    class="btn btn-sm btn-primary rounded"
                                    (click)="goToLink(item.id_documento)"
                                >
                                    {{ item.id_documento }}
                                </button>
                            </td>
                            <td>{{ item.no_venta }}</td>
                            <td>{{ item.solicitante }}</td>
                            <td>{{ item.created_at }}</td>
                            <td>{{ item.step }}</td>
                            <td>
                                <button
                                    class="btn btn-sm btn-success rounded"
                                    (click)="openModal(item.step)"
                                >
                                    Autorizar
                                </button>
                            </td>
                            <td>
                                <button
                                    class="btn btn-sm btn-danger rounded"
                                    (click)="rechazarRefacturacion(item.id)"
                                >
                                    Rechazar
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #tablaTerminados>
    <div [@fadeInOutTranslate] class="m-t-50">
        <div class="row m-t-50">
            <div class="col-md-12 table-responsive">
                <table class="table table-striped" id="rf_terminados">
                    <thead>
                        <tr>
                            <th>Documento</th>
                            <th>Venta</th>
                            <th>Estado</th>
                            <th>Solicitante</th>
                            <th>Creado</th>
                            <th>Autorizado/Rechazado por</th>
                            <th>Autorizado/Rechazado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of terminados">
                            <td>
                                <button
                                    class="btn btn-sm btn-primary rounded"
                                    (click)="goToLink(item.id_documento)"
                                >
                                    {{ item.id_documento }}
                                </button>
                            </td>
                            <td>{{ item.no_venta }}</td>
                            <td [ngSwitch]="item.step">
                                <span
                                    class="badge badge-success"
                                    *ngSwitchCase="3"
                                    >Autorizado</span
                                >
                                <span
                                    class="badge badge-danger"
                                    *ngSwitchCase="99"
                                    >Rechazado</span
                                >
                            </td>
                            <td>{{ item.solicitante }}</td>
                            <td>{{ item.created_at }}</td>
                            <td>
                                {{
                                    item.step == 3
                                        ? item.autorizante
                                        : item.denegente
                                }}
                            </td>
                            <td>
                                {{
                                    item.step == 3
                                        ? item.authorized_at
                                        : item.denied_at
                                }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #modal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="d('Cross click')"
            id="cerrar_modal"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <aw-wizard [defaultStepIndex]="idxx">
            <aw-wizard-step stepTitle="Title of step 1" awOptionalStep>
                Content of Step 1
                <button type="button" awNextStep>Next Step</button>
                <button type="button" [awGoToStep]="{ stepIndex: 2 }">
                    Go directly to third Step
                </button>
            </aw-wizard-step>
            <aw-wizard-step stepTitle="Title of step 2" awOptionalStep>
                Content of Step 2
                <button type="button" awNextStep>Go to next step</button>
            </aw-wizard-step>
            <aw-wizard-step stepTitle="Title of step 3" awOptionalStep>
                Content of Step 3
                <button type="button">Finish</button>
            </aw-wizard-step>
        </aw-wizard>
    </div>
</ng-template>

<ngx-spinner
    bdColor="rgba(51,51,51,0.8)"
    size="medium"
    color="#fff"
    type="ball-scale-multiple"
>
    <p style="font-size: 20px; color: white">Procesando {{ loadingTitle }}</p>
</ngx-spinner>
