<form class="md-float-material form-material" #f="ngForm">
    <div class="auth-box card">
        <div class="card-block">
            <h4 class="sub-title m-t-20">Cuentas bancarias</h4>
            <div class="row">
                <div class="col-md-12 m-b-10">
                    <button type="button" class="btn btn-info btn-sm" (click)="openModal(modalCuenta)">
                        <i class="fa fa-plus"></i> Nueva cuenta bancaria
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Banco</th>
                            <th>No. cuenta</th>
                            <th>CLABE</th>
                            <th>Sucursal</th>
                            <th>Convenio</th>
                            <th>Swift</th>
                            <th>Moneda</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let row of cuentas">
                            <td>{{ row.nombre }}</td>
                            <td>{{ row.banco }}</td>
                            <td>{{ row.numero }}</td>
                            <td>{{ row.clabe }}</td>
                            <td>{{ row.sucursal }}</td>
                            <td>{{ row.convenio }}</td>
                            <td>{{ row.swift }}</td>
                            <td>{{ row.moneda }}</td>
                            <td class="text-center">
                                <button
                                    class="btn btn-outline-primary btn-action mr-1"
                                    style="padding: 4px 10px; font-size: 1.1rem;"
                                    (click)="openModal(modalCuenta, row)">
                                    <i class="fa fa-pen"></i>
                                </button>
                                <button
                                    class="btn btn-outline-danger btn-action"
                                    style="padding: 4px 10px; font-size: 1.1rem;"
                                    (click)="eliminar(row)">
                                    <i class="fa fa-trash"></i>
                                </button>

                            </td>
                        </tr>
                        <tr *ngIf="cuentas.length === 0">
                            <td colspan="9" class="text-center">Sin cuentas bancarias registradas</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Modal para crear/editar cuenta bancaria -->
<ng-template #modalCuenta let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">{{ data.id ? 'Editar' : 'Nueva' }} cuenta bancaria</h4>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form class="md-float-material form-material" #formCuenta="ngForm" (ngSubmit)="guardarCuenta(c)">
        <div class="modal-body">
            <div class="row">
                <!-- NOMBRE DE CUENTA -->
                <div class="col-md-12 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="nombre" [(ngModel)]="data.nombre" required maxlength="50">
                        <span class="form-bar"></span>
                        <label class="float-label">Nombre</label>
                        <small class="text-danger messages block" *ngIf="formCuenta.submitted && !data.nombre">Campo requerido</small>
                    </div>
                </div>

                <!-- BANCO: Búsqueda + Select -->
                <div class="col-md-8" [hidden]="bancosBuscados.length > 0">
                    <div class="form-group form-primary">
                        <input
                            type="text"
                            name="banco_input"
                            class="form-control"
                            [(ngModel)]="data.banco_input"
                            (keyup.enter)="buscarBanco()"
                            maxlength="100"
                        />
                        <span class="form-bar"></span>
                        <label class="float-label">Buscar banco</label>
                    </div>
                </div>
                <div class="col-md-8" [hidden]="bancosBuscados.length == 0">
                    <div class="form-group form-primary">
                        <select
                            name="select_banco"
                            class="form-control"
                            [(ngModel)]="data.banco"
                            required
                        >
                            <option value="" selected disabled></option>
                            <option
                                value="{{ banco.id }}"
                                *ngFor="let banco of bancosBuscados"
                            >
                                {{ banco.nombre }}
                            </option>
                        </select>
                        <span class="form-bar"></span>
                        <label class="float-label">Seleccionar banco</label>
                        <small class="text-danger messages block" *ngIf="formCuenta.submitted && !data.banco">Campo requerido</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-info btn-sm btn-block" (click)="buscarBanco()">
                        Buscar
                    </button>
                </div>

                <!-- NUMERO DE CUENTA -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="numero" [(ngModel)]="data.numero" maxlength="20">
                        <span class="form-bar"></span>
                        <label class="float-label">Número de cuenta</label>
                    </div>
                </div>

                <!-- CLABE -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="clabe" [(ngModel)]="data.clabe" maxlength="18">
                        <span class="form-bar"></span>
                        <label class="float-label">CLABE</label>
                    </div>
                </div>

                <!-- SUCURSAL -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="sucursal" [(ngModel)]="data.sucursal" maxlength="30">
                        <span class="form-bar"></span>
                        <label class="float-label">Sucursal</label>
                    </div>
                </div>

                <!-- CONVENIO -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="convenio" [(ngModel)]="data.convenio" maxlength="30">
                        <span class="form-bar"></span>
                        <label class="float-label">Convenio</label>
                    </div>
                </div>

                <!-- SWIFT -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <input type="text" class="form-control" name="swift" [(ngModel)]="data.swift" maxlength="20">
                        <span class="form-bar"></span>
                        <label class="float-label">Swift</label>
                    </div>
                </div>

                <!-- MONEDA -->
                <div class="col-md-6 m-b-10">
                    <div class="form-group form-primary">
                        <select
                            name="moneda"
                            class="form-control"
                            [(ngModel)]="data.moneda"
                            required
                        >
                            <option value="" selected disabled></option>
                            <option
                                value="{{ moneda.id }}"
                                *ngFor="let moneda of monedas"
                            >
                                {{ moneda.moneda }}
                            </option>
                        </select>
                        <span class="form-bar"></span>
                        <label class="float-label">Moneda</label>
                        <small class="text-danger messages block" *ngIf="formCuenta.submitted && !data.moneda">Campo requerido</small>
                    </div>
                </div>

            </div>
        </div>
        <div class="modal-footer" style="border-top: none;">
            <button type="submit" class="btn btn-info btn-block" [disabled]="formCuenta.invalid">
                <i class="fa fa-save"></i> Guardar
            </button>
        </div>

    </form>
</ng-template>



