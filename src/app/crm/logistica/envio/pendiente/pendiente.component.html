<div class="card">
    <div class="card-header">
        <h5>Pendientes</h5>
    </div>
    <div class="card-block table-responsive">
        <div class="row">
            <div class="col-md-12">
                <table
                    class="table table-striped"
                    id="logistica_envio_pendiente"
                >
                    <thead>
                        <tr>
                            <th>Documento</th>
                            <th>Marketplace</th>
                            <th>Cliente</th>
                            <th>Paquetería</th>
                            <th>Vendedor</th>
                            <th>Fecha</th>
                            <th
                                *ngIf="usuario.niveles.indexOf(6) > -1 || admin"
                            >
                                Packing
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let venta of ventas">
                            <td>
                                <button
                                    class="btn btn-info btn-sm btn-block"
                                    (click)="detalleVenta(modalventa, venta.id)"
                                >
                                    {{ venta.id }}
                                </button>
                            </td>
                            <td>
                                {{ venta.marketplace + " / " + venta.area }}
                            </td>
                            <td>{{ venta.cliente }}</td>
                            <td>{{ venta.paqueteria_text }}</td>
                            <td>{{ venta.usuario }}</td>
                            <td>{{ venta.created_at }}</td>
                            <td
                                *ngIf="usuario.niveles.indexOf(6) > -1 || admin"
                            >
                                <button
                                    class="btn btn-danger btn-sm btn-block"
                                    (click)="regresarVenta(venta.id)"
                                    placement="left"
                                    ngbTooltip="Regresar venta a Packing"
                                >
                                    <i class="fa fa-2x fa-shopping-basket"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<ng-template #modalventa let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Informacion de la venta</h4>
        <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="d('Cross click')"
            id="cerrar_modal"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body table-responsive">
        <div class="form-horizontal form-bordered">
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Documento</label>
                <div class="col-sm-10 inline-block">
                    <h5>{{ final_data.documento }}</h5>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Cliente</label>
                <div class="col-sm-10 inline-block">
                    <h5>{{ data.cliente }}</h5>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Marketplace</label>
                <div class="col-sm-10 inline-block">
                    <h5>{{ data.marketplace + " / " + data.area }}</h5>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Paquetería</label>
                <div class="col-sm-10 inline-block">
                    <form
                        class="md-float-material form-material m-t-20 col-md-12"
                        autocomplete="off"
                    >
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group form-primary">
                                    <select
                                        name="documento_paqueteria"
                                        id="documento_paqueteria"
                                        class="form-control"
                                        [(ngModel)]="data.paqueteria"
                                        (change)="cambiarPaqueteria()"
                                    >
                                        <option
                                            value=""
                                            disabled
                                            selected
                                        ></option>
                                        <option
                                            value="{{ paqueteria.id }}"
                                            *ngFor="
                                                let paqueteria of paqueterias
                                            "
                                        >
                                            {{ paqueteria.paqueteria }}
                                        </option>
                                    </select>
                                    <span class="form-bar"></span>
                                    <label class="float-label"
                                        >Paquetería</label
                                    >
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2"
                    >Dirección de envío</label
                >
                <div class="col-sm-10 inline-block">
                    <h5 *ngIf="data.direccion != 0">
                        {{
                            data.direccion.calle +
                                " " +
                                data.direccion.numero +
                                " " +
                                data.direccion.numero_int +
                                ", " +
                                data.direccion.colonia +
                                ", " +
                                data.direccion.ciudad +
                                ", " +
                                data.direccion.estado
                        }}
                    </h5>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Documentos</label>
                <div class="col-sm-10 inline-block">
                    <ul class="m-t-30" *ngIf="data.archivos.length > 0">
                        <li *ngFor="let archivo of data.archivos">
                            <i class="fa fa-{{ archivo.icon }}"></i>
                            <span
                                class="text-muted"
                                (click)="verArchivo(archivo.dropbox)"
                                style="cursor: pointer"
                                >{{ archivo.nombre }}</span
                            >
                            -
                            <button
                                class="btn btn-danger btn-sm http-disabled"
                                (click)="borrarArchivo(archivo.dropbox)"
                                [hidden]="user_id != archivo.id"
                            >
                                Borrar
                            </button>
                        </li>
                    </ul>
                    <h5 *ngIf="data.archivos.length == 0">Sin archivos</h5>
                    <button
                        class="btn btn-sm btn-block btn-info m-t-10 m-b-10 http-disabled"
                        style="float: left"
                        [hidden]="data.descargar_documento == 0"
                        (click)="descargarGuia()"
                    >
                        Descargar guía
                    </button>
                    <a
                        class="btn btn-sm btn-info m-t-10 m-b-10 btn-block"
                        style="float: left"
                        [hidden]="data.crear_guia == 0"
                        [routerLink]="[
                            '/logistica/guia/crear',
                            final_data.documento
                        ]"
                        target="_blank"
                        >Generar guía</a
                    >
                </div>
            </div>
            <div
                class="form-group group-div"
                [hidden]="
                    ['Recoge en Sucursal', 'Sellcenter', 'Uber', 'OMG'].indexOf(
                        data.paqueteria_text
                    ) != -1
                "
            >
                <label class="col-form-label col-sm-2">Guía</label>
                <div class="col-sm-10 inline-block table-responsive">
                    <form
                        class="md-float-material form-material m-t-20 m-b-20 col-md-12"
                        autocomplete="off"
                    >
                        <div class="row">
                            <div class="col-md-10">
                                <div class="form-group form-primary">
                                    <input
                                        type="text"
                                        name="criterio"
                                        id="criterio"
                                        class="form-control"
                                        [(ngModel)]="data.guia"
                                        (keyup.enter)="agregarGuia($event)"
                                    />
                                    <span class="form-bar"></span>
                                    <label class="float-label">Guía</label>
                                </div>
                            </div>

                            <div
                                class="col-md-2 m-b-20"
                                style="float: left; margin-top: -14px"
                            >
                                <label
                                    for=""
                                    style="display: block; font-size: 9pt"
                                    >Seguro</label
                                >
                                <ui-switch
                                    class="js-single"
                                    color="#4680ff"
                                    switchColor="#fff"
                                    size="medium"
                                    name="seguro"
                                    id="seguro"
                                    [(ngModel)]="final_data.seguro"
                                    (valueChange)="asegurarGuia()"
                                ></ui-switch>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Guía</th>
                                            <th>Contenido</th>
                                            <th>Total</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr
                                            *ngFor="
                                                let guia of final_data.guias;
                                                let index = index
                                            "
                                        >
                                            <td>{{ guia.guia }}</td>
                                            <td>
                                                <div
                                                    class="form-group form-primary"
                                                >
                                                    <input
                                                        type="text"
                                                        class="form-control"
                                                        name="guia_contenido_{{
                                                            index
                                                        }}"
                                                        [disabled]="
                                                            !final_data.seguro
                                                        "
                                                        [(ngModel)]="
                                                            guia.contenido
                                                        "
                                                    />
                                                    <span
                                                        class="form-bar"
                                                    ></span>
                                                </div>
                                            </td>
                                            <td>
                                                <div
                                                    class="form-group form-primary"
                                                >
                                                    <input
                                                        type="number"
                                                        class="form-control"
                                                        name="guia_total_{{
                                                            index
                                                        }}"
                                                        [(ngModel)]="guia.total"
                                                        [disabled]="
                                                            !final_data.seguro
                                                        "
                                                    />
                                                    <span
                                                        class="form-bar"
                                                    ></span>
                                                </div>
                                            </td>
                                            <td>
                                                <button
                                                    class="btn btn-danger btn-sm"
                                                    (click)="
                                                        final_data.guias.splice(
                                                            index,
                                                            1
                                                        )
                                                    "
                                                >
                                                    Borrar
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div
                class="form-group group-div"
                [hidden]="
                    ['Recoge en Sucursal', 'Sellcenter', 'Uber', 'OMG'].indexOf(
                        data.paqueteria_text
                    ) != -1
                "
            >
                <label class="col-form-label col-sm-2">Manifiesto</label>
                <div class="col-sm-10 inline-block">
                    <ui-switch
                        class="js-single"
                        color="#4680ff"
                        switchColor="#fff"
                        size="medium"
                        name="terminar"
                        id="terminar"
                        [(ngModel)]="final_data.manifiesto"
                    ></ui-switch>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Terminar</label>
                <div class="col-sm-10 inline-block">
                    <ui-switch
                        class="js-single"
                        color="#4680ff"
                        switchColor="#fff"
                        size="medium"
                        name="terminar"
                        id="terminar"
                        [(ngModel)]="final_data.terminar"
                    ></ui-switch>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Productos</label>
                <div class="col-sm-10 inline-block table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Descripción</th>
                                <th>Cantidad</th>
                                <th>Precio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let producto of data.productos">
                                <td>{{ producto.sku }}</td>
                                <td>{{ producto.descripcion }}</td>
                                <td>{{ producto.cantidad }}</td>
                                <td>$ {{ producto.precio }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">Seguimiento</label>
                <div class="col-sm-10 inline-block">
                    <app-new-editor
                        class="m-t-20"
                        name="seguimiento"
                        [(ngModel)]="final_data.seguimiento"
                    >
                    </app-new-editor>

                    <div
                        *ngFor="let seguimiento of data.seguimiento_anterior"
                        class="m-t-20 m-b-20"
                    >
                        <div class="media chat-messages">
                            <div class="media-body chat-menu-content">
                                <div class="">
                                    <p class="chat-cont">
                                        {{
                                            seguimiento.nombre +
                                                " - " +
                                                seguimiento.created_at
                                        }}
                                    </p>
                                    <p
                                        class="chat-cont"
                                        [innerHTML]="seguimiento.seguimiento"
                                    ></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group group-div">
                <label class="col-form-label col-sm-2">&nbsp;</label>
                <div class="col-sm-10 inline-block">
                    <button
                        class="btn btn-sm btn-block btn-info http-disabled"
                        style="margin: 10px"
                        (click)="guardarDocumento()"
                        id="button_guardar"
                        [disabled]="final_data.seguimiento == ''"
                    >
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</ng-template>
